generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Brand {
  id        String     @id @default(cuid())
  name      String     @unique(map: "Brand_name_key")
  isActive  Boolean    @default(true)
  createdAt DateTime   @default(now())
  carmodel  CarModel[]

  @@map("brand")
}

model CarModel {
  id        String   @id @default(cuid())
  brandId   String
  name      String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  brand     Brand    @relation(fields: [brandId], references: [id], map: "CarModel_brandId_fkey")

  @@unique([brandId, name], map: "CarModel_brandId_name_key")
  @@index([brandId], map: "CarModel_brandId_idx")

  @@map("carmodel")
}

model Employee {
  id                String         @id @default(cuid())
  name              String
  email             String         @unique(map: "Employee_email_key")
  phone             String
  role              String         @default("technician")
  isActive          Boolean        @default(true)
  createdAt         DateTime       @default(now())
  completedServices Int            @default(0)
  locationId        String?
  passwordHash      String?
  username          String?        @unique(map: "Employee_username_key")
  language          String         @default("es")
  location          Location?      @relation(fields: [locationId], references: [id], map: "Employee_locationId_fkey")
  vehicleentry      VehicleEntry[]

  @@index([locationId], map: "Employee_locationId_idx")

  @@map("employee")
}

model EntryUpdate {
  id           String       @id @default(cuid())
  entryId      String
  text         String
  createdAt    DateTime     @default(now())
  entry        VehicleEntry @relation(fields: [entryId], references: [id], map: "EntryUpdate_entryId_fkey")
  photos       Photo[]

  @@index([entryId], map: "EntryUpdate_entryId_idx")

  @@map("entryupdate")
}

model Location {
  id        String     @id @default(cuid())
  name      String
  address   String?
  city      String?
  country   String?
  isActive  Boolean    @default(true)
  createdAt DateTime   @default(now())
  employee  Employee[]

  @@map("location")
}

model Photo {
  id           String       @id @default(cuid())
  entryId      String
  type         String
  url          String
  createdAt    DateTime     @default(now())
  updateId     String?
  entry        VehicleEntry @relation(fields: [entryId], references: [id], map: "Photo_entryId_fkey")
  update       EntryUpdate? @relation(fields: [updateId], references: [id], map: "Photo_updateId_fkey")

  @@index([entryId], map: "Photo_entryId_idx")
  @@index([type], map: "Photo_type_idx")
  @@index([updateId], map: "Photo_updateId_idx")

  @@map("photo")
}

model Service {
  id           String         @id @default(cuid())
  name         String
  description  String?
  price        Int
  duration     Int
  isActive     Boolean        @default(true)
  createdAt    DateTime       @default(now())
  vehicleentry VehicleEntry[]

  @@map("service")
}

model Settings {
  id          String   @id @default(cuid())
  companyName String
  ein         String?
  address     String?
  phone       String?
  email       String?
  hours       String?
  createdAt   DateTime @default(now())
  logo        String?
  currency    String   @default("COP")

  @@map("settings")
}

model Vehicle {
  id           String         @id @default(cuid())
  vin          String         @unique(map: "Vehicle_vin_key")
  internalCode String         @unique(map: "Vehicle_internalCode_key")
  brand        String
  model        String
  color        String
  year         Int
  createdAt    DateTime       @default(now())
  vehicleentry VehicleEntry[]

  @@map("vehicle")
}

model VehicleEntry {
  id             String        @id @default(cuid())
  vehicleId      String
  employeeId     String
  serviceId      String
  status         String        @default("pending")
  arrivalDate    DateTime
  completionDate DateTime?
  notes          String?
  createdAt      DateTime      @default(now())
  finalNotes     String?
  updates        EntryUpdate[]
  photos         Photo[]
  employee       Employee      @relation(fields: [employeeId], references: [id], map: "VehicleEntry_employeeId_fkey")
  service        Service       @relation(fields: [serviceId], references: [id], map: "VehicleEntry_serviceId_fkey")
  vehicle        Vehicle       @relation(fields: [vehicleId], references: [id], map: "VehicleEntry_vehicleId_fkey")

  @@index([arrivalDate], map: "VehicleEntry_arrivalDate_idx")
  @@index([employeeId], map: "VehicleEntry_employeeId_idx")
  @@index([serviceId], map: "VehicleEntry_serviceId_fkey")
  @@index([status], map: "VehicleEntry_status_idx")
  @@index([vehicleId], map: "VehicleEntry_vehicleId_idx")

  @@map("vehicleentry")
}
